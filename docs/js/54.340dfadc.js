"use strict";(self["webpackChunkkwplayer"]=self["webpackChunkkwplayer"]||[]).push([[54],{9054:function(e,t,a){a.r(t),a.d(t,{WaveParser:function(){return f}});a(8111),a(7588);var i=a(8968),n=a(7636),s=a(4940);const r={len:8,get:(e,t)=>({chunkID:new n.StringType(4,"latin1").get(e,t),chunkSize:n.UINT32_LE.get(e,t+4)})};class o{constructor(e){this.tagHeader=e,this.len=e.chunkSize,this.len+=1&this.len}get(e,t){return new n.StringType(this.tagHeader.chunkSize,"ascii").get(e,t)}}var h=a(5775);class c extends((0,h.fO)("Wave")){}const k={PCM:1,ADPCM:2,IEEE_FLOAT:3,MPEG_ADTS_AAC:5632,MPEG_LOAS:5634,RAW_AAC1:255,DOLBY_AC3_SPDIF:146,DVM:8192,RAW_SPORT:576,ESST_AC3:577,DRM:9,DTS2:8193,MPEG:80},d={[k.PCM]:"PCM",[k.ADPCM]:"ADPCM",[k.IEEE_FLOAT]:"IEEE_FLOAT",[k.MPEG_ADTS_AAC]:"MPEG_ADTS_AAC",[k.MPEG_LOAS]:"MPEG_LOAS",[k.RAW_AAC1]:"RAW_AAC1",[k.DOLBY_AC3_SPDIF]:"DOLBY_AC3_SPDIF",[k.DVM]:"DVM",[k.RAW_SPORT]:"RAW_SPORT",[k.ESST_AC3]:"ESST_AC3",[k.DRM]:"DRM",[k.DTS2]:"DTS2",[k.MPEG]:"MPEG"};class g{constructor(e){if(e.chunkSize<16)throw new c("Invalid chunk size");this.len=e.chunkSize}get(e,t){return{wFormatTag:n.UINT16_LE.get(e,t),nChannels:n.UINT16_LE.get(e,t+2),nSamplesPerSec:n.UINT32_LE.get(e,t+4),nAvgBytesPerSec:n.UINT32_LE.get(e,t+8),nBlockAlign:n.UINT16_LE.get(e,t+12),wBitsPerSample:n.UINT16_LE.get(e,t+14)}}}class m{constructor(e){if(e.chunkSize<4)throw new c("Invalid fact chunk size.");this.len=e.chunkSize}get(e,t){return{dwSampleLength:n.UINT32_LE.get(e,t)}}}var u=a(9219),l=a(1488),T=a(8442),S=a(6351);const I={len:420,get:(e,t)=>({description:(0,l.F6)(new n.StringType(256,"ascii").get(e,t)).trim(),originator:(0,l.F6)(new n.StringType(32,"ascii").get(e,t+256)).trim(),originatorReference:(0,l.F6)(new n.StringType(32,"ascii").get(e,t+288)).trim(),originationDate:(0,l.F6)(new n.StringType(10,"ascii").get(e,t+320)).trim(),originationTime:(0,l.F6)(new n.StringType(8,"ascii").get(e,t+330)).trim(),timeReferenceLow:n.UINT32_LE.get(e,t+338),timeReferenceHigh:n.UINT32_LE.get(e,t+342),version:n.UINT16_LE.get(e,t+346),umid:new n.Uint8ArrayType(64).get(e,t+348),loudnessValue:n.UINT16_LE.get(e,t+412),maxTruePeakLevel:n.UINT16_LE.get(e,t+414),maxMomentaryLoudness:n.UINT16_LE.get(e,t+416),maxShortTermLoudness:n.UINT16_LE.get(e,t+418)})},w=s("music-metadata:parser:RIFF");class f extends S.s{constructor(){super(...arguments),this.blockAlign=0}async parse(){const e=await this.tokenizer.readToken(r);if(w(`pos=${this.tokenizer.position}, parse: chunkID=${e.chunkID}`),"RIFF"===e.chunkID)return this.metadata.setAudioOnly(),this.parseRiffChunk(e.chunkSize).catch(e=>{if(!(e instanceof i.d1))throw e})}async parseRiffChunk(e){const t=await this.tokenizer.readToken(T.e);switch(this.metadata.setFormat("container",t),t){case"WAVE":return this.readWaveChunk(e-T.e.len);default:throw new c(`Unsupported RIFF format: RIFF/${t}`)}}async readWaveChunk(e){while(e>=r.len){const t=await this.tokenizer.readToken(r);switch(e-=r.len+t.chunkSize,t.chunkSize>e&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=t,w(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${t.chunkID}`),t.chunkID){case"LIST":await this.parseListTag(t);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new m(t));break;case"fmt ":{const e=await this.tokenizer.readToken(new g(t));let a=d[e.wFormatTag];a||(w(`WAVE/non-PCM format=${e.wFormatTag}`),a=`non-PCM (${e.wFormatTag})`),this.metadata.setFormat("codec",a),this.metadata.setFormat("bitsPerSample",e.wBitsPerSample),this.metadata.setFormat("sampleRate",e.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",e.nChannels),this.metadata.setFormat("bitrate",e.nBlockAlign*e.nSamplesPerSec*8),this.blockAlign=e.nBlockAlign;break}case"id3 ":case"ID3 ":{const e=await this.tokenizer.readToken(new n.Uint8ArrayType(t.chunkSize)),a=i.vY(e);await(new u.S).parse(this.metadata,a,this.options);break}case"data":{!1!==this.metadata.format.lossless&&this.metadata.setFormat("lossless",!0);let e=t.chunkSize;if(this.tokenizer.fileInfo.size){const t=this.tokenizer.fileInfo.size-this.tokenizer.position;t<e&&(this.metadata.addWarning("data chunk length exceeding file length"),e=t)}const a=this.fact?this.fact.dwSampleLength:4294967295===e?void 0:e/this.blockAlign;a&&(this.metadata.setFormat("numberOfSamples",a),this.metadata.format.sampleRate&&this.metadata.setFormat("duration",a/this.metadata.format.sampleRate)),"ADPCM"===this.metadata.format.codec?this.metadata.setFormat("bitrate",352e3):this.metadata.format.sampleRate&&this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(t.chunkSize);break}case"bext":{const e=await this.tokenizer.readToken(I);Object.keys(e).forEach(t=>{this.metadata.addTag("exif",`bext.${t}`,e[t])});const a=t.chunkSize-I.len;await this.tokenizer.ignore(a);break}case"\0\0\0\0":w(`Ignore padding chunk: RIFF/${t.chunkID} of ${t.chunkSize} bytes`),this.metadata.addWarning(`Ignore chunk: RIFF/${t.chunkID}`),await this.tokenizer.ignore(t.chunkSize);break;default:w(`Ignore chunk: RIFF/${t.chunkID} of ${t.chunkSize} bytes`),this.metadata.addWarning(`Ignore chunk: RIFF/${t.chunkID}`),await this.tokenizer.ignore(t.chunkSize)}this.header.chunkSize%2===1&&(w("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(e){const t=await this.tokenizer.readToken(new n.StringType(4,"latin1"));switch(w("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,t),t){case"INFO":return this.parseRiffInfoTags(e.chunkSize-4);default:return this.metadata.addWarning(`Ignore chunk: RIFF/WAVE/LIST/${t}`),w(`Ignoring chunkID=RIFF/WAVE/LIST/${t}`),this.tokenizer.ignore(e.chunkSize-4).then()}}async parseRiffInfoTags(e){while(e>=8){const t=await this.tokenizer.readToken(r),a=new o(t),i=await this.tokenizer.readToken(a);this.addTag(t.chunkID,l.F6(i)),e-=8+a.len}if(0!==e)throw new c(`Illegal remaining size: ${e}`)}addTag(e,t){this.metadata.addTag("exif",e,t)}}}}]);
//# sourceMappingURL=54.340dfadc.js.map